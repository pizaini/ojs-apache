[supervisord]
nodaemon=true
user=root
minfds=1024
minprocs=200

; ───────────────────────────────
; OJS Queue Worker
; ───────────────────────────────
[program:ojs-queue-monitor]
command=php /var/www/html/lib/pkp/tools/jobs.php work --sleep=3
directory=/var/www/html
autostart=true
autorestart=unexpected
startretries=3
startsecs=5
stopwaitsecs=10
numprocs=1
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5

; ───────────────────────────────
; Apache Web Server
; ───────────────────────────────
[program:apache2]
command=/usr/sbin/apache2ctl -D FOREGROUND
autostart=true
autorestart=false
numprocs=1
redirect_stderr=true
stopwaitsecs=3600
startsecs=5
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5

; ───────────────────────────────
; OJS Scheduler
; ───────────────────────────────
[program:ojs-scheduler]
command=bash -c 'while true; do php /var/www/html/lib/pkp/tools/scheduler.php run; sleep 60; done'
directory=/var/www/html
autostart=true
autorestart=true
startsecs=5
numprocs=1